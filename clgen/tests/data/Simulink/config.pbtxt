# A  corpus of Simulink mdl Files of 1000 processed models.
# It should take around 30 minutes to train on a reasonably powerful GPU,
# and maybe around an hour on a CPU.
working_dir: "/tmp/experiments"
model {
  corpus {
    local_tar_archive: "$PWD/mdl.tar.bz2"
    #ascii_character_atomizer: true
     greedy_multichar_atomizer {
           tokens: "slope"
      tokens: "ContentPreviewEnabled"
      tokens: "ScreenColor"
      tokens: "OutValues"
      tokens: "SrcBlock"
      tokens: "SampleTime"
      tokens: "ICPrevInput"
      tokens: "Filename"
      tokens: "Branch"
      tokens: "SID"
      tokens: "BlockType"
      tokens: "ymin"
      tokens: "Port"
      tokens: "OutputDataTypeScalingMode"
      tokens: "ymax"
      tokens: "TimeValues"
      tokens: "SrcPort"
      tokens: "SourceBlock"
      tokens: "SaturateOnIntegerOverflow"
      tokens: "start"
      tokens: "includeCurrent"
      tokens: "ModelBrowserVisibility"
      tokens: "X0"
      tokens: "ZeroZ"
      tokens: "OutputPortMap"
      tokens: "rep_seq_t"
      tokens: "SaveFormat"
      tokens: "Save2DSignal"
      tokens: "Ts"
      tokens: "LibraryVersion"
      tokens: "rep_seq_y"
      tokens: "Value"
      tokens: "PaperType"
      tokens: "Points"
      tokens: "T"
      tokens: "FixptAsFi"
      tokens: "Position"
      tokens: "InitialConditionSetting"
      tokens: "DoSatur"
      tokens: "Ports"
      tokens: "OutMax"
      tokens: "NumInputPorts"
      tokens: "Decimation"
      tokens: "Period"
      tokens: "ShowPageBoundaries"
      tokens: "PoleZ"
      tokens: "InputProcessing"
      tokens: "OutMin"
      tokens: "xmax"
      tokens: "Name"
      tokens: "PaperOrientation"
      tokens: "VariableName"
      tokens: "SIDHighWatermark"
      tokens: "DelayLengthSource"
      tokens: "f1"
      tokens: "f2"
      tokens: "Gain"
      tokens: "PulseType"
      tokens: "System"
      tokens: "tsamp"
      tokens: "PaperPositionMode"
      tokens: "ShowEnablePort"
      tokens: "seed"
      tokens: "Poles"
      tokens: "Location"
      tokens: "Units"
      tokens: "PortBlocksUseCompactNotation"
      tokens: "LookUpMeth"
      tokens: "ConRadixGroup"
      tokens: "TiledPageScale"
      tokens: "ReportName"
      tokens: "xmin"
      tokens: "uplimit"
      tokens: "DstBlock"
      tokens: "ZoomFactor"
      tokens: "InputPortMap"
      tokens: "TiledPaperMargins"
      tokens: "After"
      tokens: "SourceProductName"
      tokens: "ZOrder"
      tokens: "NumDelays"
      tokens: "OutScaling"
      tokens: "Line"
      tokens: "PaperUnits"
      tokens: "RndMeth"
      tokens: "Cov"
      tokens: "NumBits"
      tokens: "ICPrevOutput"
      tokens: "DelayOrder"
      tokens: "SourceProductBaseCode"
      tokens: "IconDisplay"
      tokens: "LockScale"
      tokens: "Model"
      tokens: "samptime"
      tokens: "{"
      tokens: "Block"
      tokens: "SourceType"
      tokens: "ICPrevScaledInput"
      tokens: "Open"
      tokens: "st"
      tokens: "PulseWidth"
      tokens: "MaxDataPoints"
      tokens: "VectorParams1D"
      tokens: "OutDataType"
      tokens: "Floating"
      tokens: "DstPort"
      tokens: "}"
      tokens: "vinit"
      tokens: "ModelBrowserWidth"
      tokens: "OutDataTypeStr"
     }
    contentfile_separator: "\n\n"
    preprocessor: "clgen.preprocessors.common:StripDuplicateEmptyLines"
    preprocessor: "clgen.preprocessors.common:StripTrailingWhitespace"
    preprocessor: "clgen.preprocessors.common:MinimumLineCount3"
    preprocessor: "clgen.preprocessors.simulink:interLeaveBlocksandLines"
  }
  architecture {
    backend: TENSORFLOW
    neuron_type: LSTM
    neurons_per_layer: 128
    num_layers: 2
    post_layer_dropout_micros: 0  # = 0.0 real value
  }
  training {
    num_epochs: 32
    sequence_length: 64
    batch_size: 64
    shuffle_corpus_contentfiles_between_epochs: false
    adam_optimizer {
      initial_learning_rate_micros: 2000  # = 0.01 real value
      learning_rate_decay_per_epoch_micros: 50000  # = 0.05 real value
      beta_1_micros: 900000  # = 0.9 real value
      beta_2_micros: 999000  # = 0.999 real value
      normalized_gradient_clip_micros: 5000000  # = 5.0 real value
    }
  }
}
sampler {
  start_text: "Model {"
  batch_size: 1
  temperature_micros: 800000  # = 0.8 real value
  termination_criteria {
    symtok {
      depth_increase_token: "{"
      depth_decrease_token: "}"
    }
  }
  termination_criteria {
    maxlen {
      maximum_tokens_in_sample: 500
    }
  }
}
